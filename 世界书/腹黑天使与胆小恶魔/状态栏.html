<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #ff9a9e;
      --bg-gradient: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);
      --card-bg: rgba(255, 255, 255, 0.95);
      --text-color: #555;

      /* Hikari Colors */
      --hikari-main: #87CEEB; /* Sky Blue */
      --hikari-accent: #FFD700; /* Gold */
      --hikari-bg: #F0F8FF;

      /* Kurenai Colors */
      --kurenai-main: #FF69B4; /* Hot Pink */
      --kurenai-accent: #800080; /* Purple */
      --kurenai-bg: #FFF0F5;
    }

    body {
      margin: 0;
      padding: 10px;
      font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
      font-size: 14px;
      color: var(--text-color);
      background: transparent;
    }

    .status-card {
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      border: 2px solid #fff;
    }

    .main-header {
      background: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);
      padding: 10px 15px;
      text-align: center;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      font-size: 1.1em;
      border-bottom: 2px solid #fff;
    }

    .world-info {
      padding: 10px 15px;
      background: #fdfbf7;
      border-bottom: 1px dashed #ddd;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 5px;
    }

    .info-tag {
      background: #fff;
      padding: 2px 8px;
      border-radius: 12px;
      border: 1px solid #eee;
      font-size: 0.9em;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      display: flex;
      align-items: center;
    }

    .info-tag i { color: #999; margin-right: 6px; }
    .info-value { font-weight: 600; color: #444; }

    .character-section {
      padding: 10px 15px;
      border-bottom: 1px solid #f0f0f0;
      transition: all 0.3s ease;
    }

    .character-section:last-child { border-bottom: none; }

    .hikari-theme { background-color: var(--hikari-bg); border-left: 5px solid var(--hikari-main); }
    .kurenai-theme { background-color: var(--kurenai-bg); border-left: 5px solid var(--kurenai-main); }

    .char-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .char-name {
      font-weight: bold;
      font-size: 1.1em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hikari-theme .char-name { color: #4a90e2; }
    .kurenai-theme .char-name { color: #d63384; }

    .status-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 0.9em;
      align-items: center;
    }

    .status-row i {
      width: 16px;
      text-align: center;
      margin-right: 6px;
      color: #777;
    }

    .thought-bubble {
      position: relative;
      background: #fff;
      padding: 8px 12px 8px 30px; /* Left padding for icon */
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.05);
      margin-top: 8px;
      font-style: italic;
      color: #666;
      font-size: 0.9em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    }

    .thought-bubble::before {
      font-family: "Font Awesome 6 Free";
      content: "\f4ad"; /* fa-comment-dots */
      font-weight: 900;
      position: absolute;
      left: 8px;
      top: 10px;
      font-size: 1.1em;
      color: #aaa;
    }

    /* Progress Bar Styles */
    .bar-container {
      width: 100%;
      background-color: rgba(255,255,255,0.6);
      border-radius: 10px;
      height: 18px;
      position: relative;
      margin-top: 5px;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    .bar-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.5s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 5px;
      color: white;
      font-size: 10px;
      font-weight: bold;
      text-shadow: 0 0 2px rgba(0,0,0,0.3);
    }

    .bar-harmony { background: linear-gradient(90deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); }
    .bar-hikari { background: linear-gradient(90deg, #87CEEB 0%, #4facfe 100%); }
    .bar-kurenai { background: linear-gradient(90deg, #ff9a9e 0%, #fecfef 99%, #ff69b4 100%); }

  </style>
  <script type="module">
    /* è¾…åŠ©å‡½æ•° */
    const getVal = (vars, path, defaultVal = '??') => _.get(vars, `stat_data.${path}`, defaultVal);
    
    async function populateStatus() {
      const all_variables = getAllVariables();
      
      // 1. World Info
      $('#world-time').text(getVal(all_variables, 'å½“å‰æ—¶é—´'));
      $('#world-loc').text(getVal(all_variables, 'å½“å‰åœ°ç‚¹'));
      
      // Harmony Bar
      const harmony = parseInt(getVal(all_variables, 'èæ´½åº¦', 0));
      $('#harmony-bar').css('width', `${_.clamp(harmony, 0, 100)}%`).text(`${harmony}%`);

      // 2. Hikari Data
      $('#hikari-outfit').text(getVal(all_variables, 'å¤©éŸ³å…‰.å½“å‰æœè£…'));
      $('#hikari-pose').text(getVal(all_variables, 'å¤©éŸ³å…‰.å½“å‰å§¿åŠ¿'));
      $('#hikari-thought').text(getVal(all_variables, 'å¤©éŸ³å…‰.å†…å¿ƒæ´»åŠ¨'));
      
      const hikariAffection = parseInt(getVal(all_variables, 'å¤©éŸ³å…‰.å¥½æ„Ÿåº¦', 0));
      $('#hikari-bar').css('width', `${_.clamp(hikariAffection, 0, 100)}%`).text(`${hikariAffection}%`);

      // 3. Kurenai Data
      $('#kurenai-outfit').text(getVal(all_variables, 'é­”å®«çº¢.å½“å‰æœè£…'));
      $('#kurenai-pose').text(getVal(all_variables, 'é­”å®«çº¢.å½“å‰å§¿åŠ¿'));
      $('#kurenai-thought').text(getVal(all_variables, 'é­”å®«çº¢.å†…å¿ƒæ´»åŠ¨'));
      
      const kurenaiAffection = parseInt(getVal(all_variables, 'é­”å®«çº¢.å¥½æ„Ÿåº¦', 0));
      $('#kurenai-bar').css('width', `${_.clamp(kurenaiAffection, 0, 100)}%`).text(`${kurenaiAffection}%`);
    }

    async function init() {
      await waitGlobalInitialized('Mvu');
      populateStatus();
      
      // ç›‘å¬å˜é‡æ›´æ–°äº‹ä»¶ï¼ˆå¦‚æœç³»ç»Ÿæ”¯æŒï¼‰
      // document.addEventListener('mvu-update', populateStatus); 
    }

    $(errorCatched(init));
  </script>
</head>
<body>
  <div class="status-card">
    <div class="main-header">
      ğŸ’• æ‹çˆ±å®ä¹ è§‚å¯Ÿæ—¥è®° ğŸ’•
    </div>

    <!-- World Info & Harmony -->
    <div class="world-info">
      <div class="info-tag">
        <i class="fas fa-calendar-alt"></i>
        <span class="info-value" id="world-time">--</span>
      </div>
      <div class="info-tag">
        <i class="fas fa-map-marker-alt"></i>
        <span class="info-value" id="world-loc">--</span>
      </div>
      <div style="width: 100%; margin-top: 8px;">
        <div style="display:flex; justify-content:space-between; align-items: center; font-size:0.85em; color:#888;">
          <span>
            <i class="fas fa-home" style="margin-right: 4px;"></i>
            èæ´½åº¦
          </span>
          <span>(Harmony)</span>
        </div>
        <div class="bar-container">
          <div class="bar-fill bar-harmony" id="harmony-bar" style="width: 0%">0%</div>
        </div>
      </div>
    </div>

    <!-- Hikari Section -->
    <div class="character-section hikari-theme">
      <div class="char-header">
        <span class="char-name">
          <i class="fas fa-feather-alt" style="color: gold;"></i>
          å¤©éŸ³ å…‰
        </span>
        <span style="font-size:0.8em; color:#aaa;">ANGEL</span>
      </div>
      <div class="status-row">
        <span>
          <i class="fas fa-tshirt"></i>
          æœè£…: <strong id="hikari-outfit">--</strong>
        </span>
      </div>
      <div class="status-row">
        <span>
          <i class="fas fa-user"></i>
          å§¿æ€: <strong id="hikari-pose">--</strong>
        </span>
      </div>
      <div class="thought-bubble" id="hikari-thought">
        æ­£åœ¨è§‚å¯Ÿä¸­...
      </div>
      <div style="margin-top: 8px;">
        <div style="font-size:0.8em; color:#4a90e2; margin-bottom:2px; display:flex; align-items:center;">
          <i class="fas fa-heart" style="margin-right: 4px;"></i>
          å¥½æ„Ÿåº¦ (Affection)
        </div>
        <div class="bar-container">
          <div class="bar-fill bar-hikari" id="hikari-bar" style="width: 0%">0%</div>
        </div>
      </div>
    </div>

    <!-- Kurenai Section -->
    <div class="character-section kurenai-theme">
      <div class="char-header">
        <span class="char-name">
          <i class="fas fa-dragon" style="color: purple;"></i>
          é­”å®« çº¢
        </span>
        <span style="font-size:0.8em; color:#aaa;">DEVIL</span>
      </div>
      <div class="status-row">
        <span>
          <i class="fas fa-tshirt"></i>
          æœè£…: <strong id="kurenai-outfit">--</strong>
        </span>
      </div>
      <div class="status-row">
        <span>
          <i class="fas fa-user"></i>
          å§¿æ€: <strong id="kurenai-pose">--</strong>
        </span>
      </div>
      <div class="thought-bubble" id="kurenai-thought">
        æ­£åœ¨å®³ç¾ä¸­...
      </div>
      <div style="margin-top: 8px;">
        <div style="font-size:0.8em; color:#d63384; margin-bottom:2px; display:flex; align-items:center;">
           <i class="fas fa-heart" style="margin-right: 4px;"></i>
           å¥½æ„Ÿåº¦ (Affection)
        </div>
        <div class="bar-container">
          <div class="bar-fill bar-kurenai" id="kurenai-bar" style="width: 0%">0%</div>
        </div>
      </div>
    </div>

  </div>
</body>
</html>
